{#
/**
* Tilt Boilermaker - Repeater Template - Card with Side Image
* -----
* Simple cards with title, excerpt and link
* 
#}

{# Load in global macros for use across all Twig templates #}
{% import '_macros/globalMacros' as gMacros %}

{% set cardClasses = ['repeater-card', 'col-span-12'] %}

{% if animate %}
	{% set cardClasses = cardClasses|merge(["animate"]) %}
{% endif %}

{% set countValues =  {
	'df': 1,
	'@2xs': null,
	'@xs': null,
	'@sm': null,
	'@md': null,
	'@lg': null,
	'@xl': null,
	'@2xl': null,
	'@3xl': null,
	'@4xl': null,
	'@5xl': null,
} %}

{% set countSizes =  {
	'df': 0,
	'@2xs': 288,
	'@xs': 320,
	'@sm': 384,
	'@md': 448,
	'@lg': 512,
	'@xl': 640,
	'@2xl': 768,
	'@3xl': 1024,
	'@4xl': 1280,
	'@5xl': 1536,
} %}

{% if cardRowSizes != null and cardRowSizes|length %}
	
	{% for rowSize in cardRowSizes %}
		{% set cardSizeClass = 'col-span-12' %}
		{% switch rowSize.numberOfCards %}
			{% case '1' %}
				{% set cardSizeClass = 'col-span-12' %}				
			{% case '2' %}
				{% set cardSizeClass = 'col-span-6' %}				
			{% case '3' %}
				{% set cardSizeClass = 'col-span-4' %}				
			{% case '4' %}
				{% set cardSizeClass = 'col-span-3' %}				
			{% default %}
				{% set cardSizeClass = 'col-span-12' %}
		{% endswitch %}
		
		{% if rowSize.layoutSize == '' %}
			{% set cardClasses = cardClasses|merge([cardSizeClass]) %}
			{% set countValues = countValues|merge({'df': rowSize.numberOfCards}) %}
		{% else %}
			{% set cardClasses = cardClasses|merge([rowSize.layoutSize ~ ':' ~ cardSizeClass]) %}
			{% set countValues = countValues|merge({ (rowSize.layoutSize) : rowSize.numberOfCards }) %}
		{% endif %}
	{% endfor %}
	
{% endif %}

{% set sizesAttrSm = '90vw' %}
{% set sizesAttrLg = '' %}
{% for key,value in countValues|reverse %}
	{% if value != null %}
		{% if key != 'df' %}
			{% if key == '3xl' or key == '4xl' or key == '5xl' %}
				{% set sizesAttrLg = sizesAttrLg ~ "(min-width:" ~ countSizes[key] ~ "px) calc(0.25 * (80vw / " ~ value ~ ")), " %}
			{% else %}
				{% set sizesAttrLg = sizesAttrLg ~ "(min-width:" ~ countSizes[key] ~ "px) calc(0.3333333 * (80vw / " ~ value ~ ")), " %}
			{% endif %}
		{% else %}
			{% if value != 1 %}
				{% set sizesAttrSm = sizesAttrSm ~ "calc(90vw / " ~ value ~ ")" %}
			{% else %}
				{% set sizesAttrSm = sizesAttrSm ~ "90vw" %}
			{% endif %}
		{% endif %}
	{% endif %}
{% endfor %}
{% set sizesAttrLg = sizesAttrLg ~ ' 90vw' %}

<div class="repeater-list-card-wrapper">	
	{% for listItem in listContent %}	
		   {% if listItem.url != null and listItem.url|length %}
		   {% set outerTag = 'a' %}
		{% else %}
			{% set outerTag = 'div' %}
		{% endif %}
		
		<div class="{{ cardClasses|join(' ') }}">			
			<{{outerTag}} {% if listItem.url != null and listItem.url|length %}href="{{ listItem.url }}" {% if listItem.newTab %}target="_blank"{% endif %} {% endif %} class="repeater-card-inner">				
				<div class="w-full h-full @xl:flex @xl:flex-nowrap @xl:justify-center @xl:items-center">
					<div class="repeater-card-sm-img w-full @xl:h-full relative @xl:w-1/3 @3xl:w-1/4">
						<picture class="block w-full @xl:h-full">
							{% set image = listItem.image[0] %}
							{% set mobileXForm = 'image-' ~ gSettings.thumbAspectLg %}
							{% set xForm = 'image-' ~ gSettings.thumbAspectSm %}
							{% set xFormWidth = image.width %}
							{% set xFormHeight = image.height %}
							{% if gSettings.thumbAspectLg == 'auto' %}				
								{% set xFormWidth = image.width %}
								{% set xFormHeight = image.height %}
							{% else %}				
								{% if gSettings.thumbAspectLg == 'video' %}
									{% set numerator = 16 %}
									{% set denominator = 9 %} 
								{% elseif gSettings.thumbAspectLg == 'square' %}
									{% set numerator = 1 %}
									{% set denominator = 1 %} 
								{% else %}
									{% set numerator = gSettings.thumbAspectLg|split('/')|first %}
									{% set denominator = gSettings.thumbAspectLg|split('/')|last %}        
								{% endif %}
								{% set xFormWidth = image.width %}				
								{% set xFormHeight = (image.width * denominator) / numerator %}				
							{% endif %}

							{% if craft.imager.serverSupportsWebp() %}
								{%- set mobileXForm = mobileXForm ~ '-webp' %}
								{%- set xForm = xForm ~ '-webp' %}
							{% endif %}
							{%- set mobileImages = craft.imagerx.transformImage(image, mobileXForm) %}						
							{%- set largerImages = craft.imagerx.transformImage(image, xForm) %}						
							
							<source sizes="{{sizesAttrLg}}" media="(min-width: 640px)" srcset="{{ craft.imager.srcset(largerImages) }}" {% if craft.imager.serverSupportsWebp() %}type="image/webp"{% endif %}>
							
							<img src="{{ craft.imager.placeholder({width: xFormWidth, height: xFormHeight}) }}"
							width="{{xFormWidth}}"
							height="{{xFormHeight}}"
							sizes="{{sizesAttrSm}}"					  	
							srcset="{{ craft.imager.srcset(mobileImages) }}"
							alt="{{ entry.title }}"
							class="block object-cover w-full h-full object-center"
							loading="lazy"
							>

						</picture>						
					</div>
					
					<div class="repeater-card-content w-full @xl:w-2/3 @3xl:w-3/4">
						<{{ headingLvl}} class="repeater-list-card-header">					
							{{ gMacros.stripTags(listItem.title, '<b><strong><i><em><sup><sub><br>') }}					  
						</{{ headingLvl }}>
						{% if showDate and listItem.date|length %}	  		
							<div class="repeater-date">{{ listItem.date }}</div>	 
						{% endif %}
						{% if showExcerpt and listItem.excerpt|length %}	  		
							<div>{{ listItem.excerpt }}</div>	  				 
						{% endif %}	
					</div>
				</div>
			</{{outerTag}}>			        
		</div>	
	{% endfor %}
</div>
